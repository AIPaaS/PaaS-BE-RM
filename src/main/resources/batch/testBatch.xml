<?xml version="1.0" encoding="UTF-8"?> 
<beans:beans xmlns ="http://www.springframework.org/schema/batch" 
xmlns:beans="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
xsi:schemaLocation="http://www.springframework.org/schema/beans 
http://www.springframework.org/schema/beans/spring-beans-3.0.xsd 
http://www.springframework.org/schema/batch 
http://www.springframework.org/schema/batch/spring-batch-3.0.xsd">
	<beans:import resource="context.xml" />
	<beans:bean id="ansibleHostsConfig" class="com.ai.paas.cpaas.rm.manage.service.zookeeper.AnsibleHostsConfig"/>
	<beans:bean id="changeSlaveName" class="com.ai.paas.cpaas.rm.manage.service.increaseslave.ChangeSlaveName"/>
	<beans:bean id="configHostsStep" class="com.ai.paas.cpaas.rm.manage.service.increaseslave.ConfigHosts"/>
	<beans:bean id="meUser" class="com.ai.paas.cpaas.rm.manage.service.mesos.MeUser"/>
	<beans:bean id="meSlavePortStep" class="com.ai.paas.cpaas.rm.manage.service.mesos.MeSlavePort"/>
	<beans:bean id="meSlaveStep" class="com.ai.paas.cpaas.rm.manage.service.mesos.MesosSlaveStep"/>
	<beans:bean id="slaveInstallDocker" class="com.ai.paas.cpaas.rm.manage.service.increaseslave.SlaveInstallDocker"/>
	<beans:bean id="dockerVerify" class="com.ai.paas.cpaas.rm.manage.service.docker.DockerVerify"/>
	<beans:bean id="slaveInstallFlannel" class="com.ai.paas.cpaas.rm.manage.service.increaseslave.SlaveInstallFlannel"/>
	<beans:bean id="openflannelPort" class="com.ai.paas.cpaas.rm.manage.service.flannel.OpenFlannelPort"/>
	<beans:bean id="configSlaveDNS" class="com.ai.paas.cpaas.rm.manage.service.increaseslave.ConfigSlaveDNS"/>
	<beans:bean id="convertMaster" class="com.ai.paas.cpaas.rm.manage.service.increaseslave.ConvertMaster"/>
	<beans:bean id="decider" class="com.ai.paas.cpaas.rm.manage.service.increaseslave.StepDecider"/>
	<job id="openService" xmlns="http://www.springframework.org/schema/batch">
		<flow id="installZookeeper" parent="zookeeper" next="decision"/>
		<decision id="decision" decider="decider">
        	<next on="ConvertSlave" to="masterStep" />
        	<next on="COMPLETED" to="installBaseInfo" />
    	</decision>
    	<flow id="installBaseInfo" parent="baseInfo" next="installMesos"/>
		<flow id="installMesos" parent="mesos" next="installDocker"/>
		<flow id="installDocker" parent="docker" next="installFlannel"/>
		<flow id="installFlannel" parent="flannel" next="installMesosDns"/>
		<flow id="installMesosDns" parent="mesosDns"/>
		<step id="masterStep" >
				<tasklet ref="convertMaster"/>
		</step>
	</job>
	<flow id="baseInfo">
		<step id="configHostname" next="configHosts">
				<tasklet ref="changeSlaveName"/>
		</step>
		<step id="configHosts" >
				<tasklet ref="configHostsStep"/>
		</step>	
	</flow>
	<flow id="zookeeper">
    	<step id="configAnsibleHosts">
	    	<tasklet ref="ansibleHostsConfig"/>
		</step>
	</flow>
	<flow id="docker">
		<step id="dockerInstall" next="verifyDockerStep">
				<tasklet ref="slaveInstallDocker"/>
		</step>
		<step id="verifyDockerStep">
				<tasklet ref="dockerVerify"/>
		</step>
	</flow>
	<flow id="mesos">
		<step id="mesosUser" next="mesosSlaveOpenPort">
				<tasklet ref="meUser"/>
		</step>
		<step id="mesosSlaveOpenPort" next="mesosSlaveStep">
				<tasklet ref="meSlavePortStep"/>
		</step>
		<step id="mesosSlaveStep">
				<tasklet ref="meSlaveStep"/>
		</step>
	</flow>
	<flow id="mesosDns">
		<step id="configSlaveDnsStep">
			<tasklet ref="configSlaveDNS"/>
		</step>
	</flow>
	<flow id="flannel">
		<step id="flannelportStep" next="flannelInstallStep">
				<tasklet ref="openflannelPort"/>
		</step>
		<step id="flannelInstallStep">
				<tasklet ref="slaveInstallFlannel"/>
		</step>
	</flow>
</beans:beans>